<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Story Base Dashboard</title>

<!-- jsPDF Library for PDF downloads -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  /* Base & Reset */
  * { box-sizing:border-box; margin:0; padding:0; font-family:"Segoe UI",sans-serif; }
  body { background:#f5f6fa; color:#333; overflow-x:hidden; }
  a { text-decoration:none; color:inherit; }
  button { cursor:pointer; border:none; font-family:"Segoe UI",sans-serif; }

  /* Layout */
  .container { display:flex; min-height:100vh; }
  .sidebar { width:260px; background:#1e88e5; color:white; padding:2rem 1rem; display:flex; flex-direction:column; transition:0.3s; }
  .sidebar h2 { margin-bottom:2rem; font-size:1.7rem; text-align:center; letter-spacing:1px; }
  .sidebar .user { margin-bottom:2rem; text-align:center; }
  .sidebar .user img { width:90px; height:90px; border-radius:50%; margin-bottom:0.5rem; border:2px solid #fff; }
  .sidebar a { padding:0.9rem 1rem; border-radius:10px; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.7rem; transition:0.3s; font-weight:500; }
  .sidebar a:hover { background: rgba(255,255,255,0.2); }
  .sidebar a.logout { margin-top:auto; background:#e53935; justify-content:center; }
  .sidebar a.logout:hover { background:#c62828; }

  .main { flex:1; padding:2rem 2.5rem; overflow-y:auto; }

  /* Hero */
  .hero { background: linear-gradient(135deg, #42a5f5, #1e88e5); padding:2rem; border-radius:15px; text-align:center; margin-bottom:2rem; box-shadow:0 6px 18px rgba(0,0,0,0.12); color:white; }
  .hero h1 { margin-bottom:0.5rem; font-size:2rem; }
  .hero p { margin-bottom:1rem; font-size:1.2rem; }
  .hero button { background:#fff; color:#1e88e5; padding:12px 28px; border-radius:30px; font-size:1rem; font-weight:600; transition:0.3s; }
  .hero button:hover { background:#e3f2fd; transform:translateY(-2px); }

  /* Sections */
  section { margin-bottom:2.5rem; }
  section h2 { margin-bottom:1rem; font-size:1.5rem; }

  /* Story Cards */
  .story-list { display:flex; gap:1rem; overflow-x:auto; padding-bottom:0.5rem; scroll-behavior:smooth; }
  .story-card { background:white; border-radius:15px; overflow:hidden; min-width:250px; box-shadow:0 6px 18px rgba(0,0,0,0.08); transition:transform 0.3s; flex-shrink:0; display:flex; flex-direction:column; }
  .story-card:hover { transform:translateY(-5px); box-shadow:0 10px 25px rgba(0,0,0,0.15); }
  .story-card img { width:100%; height:150px; object-fit:cover; border-bottom:1px solid #ddd; }
  .story-card .content { padding:1rem; flex:1; display:flex; flex-direction:column; justify-content:space-between; }
  .story-card h3 { margin-bottom:0.5rem; font-size:1.2rem; }
  .story-card p { margin-bottom:0.7rem; color:#555; font-size:0.95rem; }
  .story-card button { background:#1e88e5; color:white; padding:8px 0; border-radius:8px; margin-bottom:5px; transition:0.3s; font-weight:600; width:100%; }
  .story-card button:hover { background:#1565c0; }

  /* Categories */
  .categories { display:flex; gap:1rem; overflow-x:auto; padding-bottom:0.5rem; }
  .category { min-width:150px; padding:1rem; border-radius:15px; font-weight:600; text-align:center; color:white; cursor:pointer; transition:0.3s; flex-shrink:0; box-shadow:0 4px 12px rgba(0,0,0,0.1); }
  .category:nth-child(1){background:linear-gradient(135deg,#f48fb1,#f06292);}
  .category:nth-child(2){background:linear-gradient(135deg,#ba68c8,#9575cd);}
  .category:nth-child(3){background:linear-gradient(135deg,#4db6ac,#26a69a);}
  .category:nth-child(4){background:linear-gradient(135deg,#ffb74d,#ff8a65);}
  .category:nth-child(5){background:linear-gradient(135deg,#ff8a65,#f06292);}
  .category:nth-child(6){background:linear-gradient(135deg,#26a69a,#00acc1);}
  .category:hover { transform:scale(1.05); }

  /* Modal Reader */
  .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:999; }
  .modal-content { background:white; width:90%; max-width:900px; max-height:90%; overflow-y:auto; border-radius:15px; padding:2rem; position:relative; }
  .modal-content h2 { margin-bottom:1rem; }
  .modal-close { position:absolute; top:15px; right:15px; background:#e53935; color:white; border-radius:50%; width:35px; height:35px; display:flex; justify-content:center; align-items:center; font-size:1.2rem; cursor:pointer; }

  /* Footer */
  footer { text-align:center; padding:1.2rem; background:#fafafa; color:#555; font-size:0.9rem; border-top:1px solid #ddd; margin-top:2rem; }

  /* Responsive */
  @media(max-width:768px){
    .container { flex-direction:column; }
    .sidebar { width:100%; flex-direction:row; overflow-x:auto; gap:0.5rem; padding:1rem; }
    .sidebar a { flex:1; text-align:center; margin:0; padding:0.5rem; font-size:0.9rem; }
    .main { padding:1rem; }
    .hero button { width:100%; }
    .story-card { min-width:200px; }
    .category { min-width:120px; font-size:0.9rem; }
  }
</style>
</head>
<body>

<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Story Base</h2>
    <div class="user">
      <img src="https://picsum.photos/100?random=7" alt="User"/>
      <div id="username">Hello, Reader!</div>
    </div>
    <a href="#continue">üìå Continue</a>
    <a href="#categories">üìö Categories</a>
    <a href="#popular">üî• Popular</a>
    <a href="#favorites">‚ù§Ô∏è Favorites</a>
    <a href="#">‚öôÔ∏è Settings</a>
    <a href="#" class="logout" onclick="logout()">üö™ Logout</a>
  </div>

  <!-- Main -->
  <div class="main">
    <div class="hero">
      <h1 id="heroName">Welcome back, Reader!</h1>
      <p>Continue your journey or explore something new</p>
      <button>Start a New Story</button>
    </div>

    <section id="continue">
      <h2>üìå Continue Reading</h2>
      <div class="story-list" id="continueList"></div>
    </section>

    <section id="categories">
      <h2>üìö Categories</h2>
      <div class="categories" id="categoryList"></div>
    </section>

    <section id="popular">
      <h2>üî• Popular Stories</h2>
      <div class="story-list" id="popularList"></div>
    </section>

    <section id="favorites">
      <h2>‚ù§Ô∏è Your Favorites</h2>
      <div class="story-list" id="favoritesList"></div>
    </section>
  </div>
</div>

<footer>
  <p>&copy; 2025 Story Base | About | Contact | Privacy | Socials</p>
</footer>

<!-- Modal for reading -->
<div class="modal" id="readerModal">
  <div class="modal-content">
    <div class="modal-close" onclick="closeModal()">√ó</div>
    <h2 id="modalTitle"></h2>
    <div id="modalBody" style="line-height:1.6; white-space:pre-wrap; font-size:16px;"></div>
    <div style="margin-top:15px; display:flex; gap:10px;">
      <button onclick="increaseFont()">A+</button>
      <button onclick="decreaseFont()">A-</button>
      <button onclick="toggleDarkMode()">üåô</button>
    </div>
  </div>
</div>

<script>
  // --- User Login ---
  const storedName = localStorage.getItem('userName') || 'Reader';
  document.getElementById('username').textContent = storedName;
  document.getElementById('heroName').textContent = `Welcome back, ${storedName}!`;

  function logout() {
    localStorage.removeItem('userName');
    location.href = "welcomepage.html";
  }

  // --- Stories Array ---
  const stories = [];
  for(let i=1;i<=10;i++){
    stories.push({
      title:"The Storm of Ravens",
      chapter:i.toString(),
      cover:`https://picsum.photos/400/200?random=${i}`,
      link:`stories/storm-of-ravens/chapter${i}.html`
    });
  }

  const categories = ["üíñ Romance","üî™ Thriller","üìö Kids","üåç Folklore","üëª Horror","üöÄ Sci-Fi"];

  // --- Render Categories ---
  function renderCategories(listId, categoryArray){
    const container = document.getElementById(listId);
    container.innerHTML = "";
    categoryArray.forEach(cat=>{
      const div = document.createElement('div');
      div.className='category';
      div.textContent=cat;
      container.appendChild(div);
    });
  }

  // --- Render Stories ---
  function renderStoryCards(containerId, storyArray){
    const container = document.getElementById(containerId);
    container.innerHTML="";
    storyArray.forEach(story=>{
      const card = document.createElement('div');
      card.className='story-card';
      card.innerHTML=`
        <img src="${story.cover}" alt="cover"/>
        <div class="content">
          <h3>${story.title}</h3>
          <p>Chapter ${story.chapter}</p>
          <button onclick='openReader(${story.chapter})'>Read</button>
          <button onclick='downloadPDF("${story.title}",${story.chapter})'>Download PDF</button>
        </div>
      `;
      container.appendChild(card);
    });
  }

  // --- Modal Reader ---
  const modal = document.getElementById('readerModal');
  const modalTitle = document.getElementById('modalTitle');
  const modalBody = document.getElementById('modalBody');
  let currentFontSize = 16;

  async function openReader(chapter){
    const story = stories.find(s=>s.chapter==chapter);
    modalTitle.textContent = `${story.title} - Chapter ${chapter}`;
    try{
      const res = await fetch(story.link);
      const html = await res.text();
      const parser = new DOMParser();
      const docHTML = parser.parseFromString(html,'text/html');
      modalBody.textContent = docHTML.body.innerText;
      modal.style.display='flex';
    }catch(err){
      modalBody.textContent='Error loading chapter.';
    }
    localStorage.setItem('lastReadChapter',chapter);
  }

  function closeModal(){ modal.style.display='none'; }
  function increaseFont(){ currentFontSize+=2; modalBody.style.fontSize=currentFontSize+'px'; }
  function decreaseFont(){ currentFontSize=Math.max(12,currentFontSize-2); modalBody.style.fontSize=currentFontSize+'px'; }
  function toggleDarkMode(){ modalBody.style.background = modalBody.style.background==='black'?'white':'black'; modalBody.style.color = modalBody.style.color==='white'?'black':'white'; }

  // --- PDF Download ---
  async function downloadPDF(title, chapter){
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const story = stories.find(s=>s.chapter==chapter);
    try{
      const res = await fetch(story.link);
      const html = await res.text();
      const parser = new DOMParser();
      const docHTML = parser.parseFromString(html,'text/html');
      const storyText = docHTML.body.innerText;
      const lines = doc.splitTextToSize(storyText, 180); // wrap text

      doc.setFontSize(14);
      doc.text(`${title} - Chapter ${chapter}`,10,20);
      let y=30;
      lines.forEach(line=>{
        if(y>280){ doc.addPage(); y=20; }
        doc.text(line,10,y);
        y+=10;
      });
      doc.save(`${title}-Chapter-${chapter}.pdf`);
    }catch(err){
      alert('Error downloading PDF');
    }
  }

  // --- Initialize ---
  renderCategories('categoryList',categories);
  renderStoryCards('continueList',stories.slice(0,2));
  renderStoryCards('popularList',stories.slice(2,5));
  renderStoryCards('favoritesList',stories.slice(5,8));

</script>
</body>
</html>
