<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Story Base Dashboard</title>

<!-- jsPDF Library for PDF downloads -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  /* Base & Reset */
  * { box-sizing:border-box; margin:0; padding:0; font-family:"Segoe UI",sans-serif; }
  body { background:#f4f6f8; color:#333; transition:0.3s; }
  a { text-decoration:none; color:inherit; }
  button { cursor:pointer; border:none; }
  
  body.dark { background:#1e1e1e; color:#f4f4f4; }
  body.dark .sidebar { background:#212121; }
  body.dark .hero { background:linear-gradient(135deg,#333,#555); color:white; }
  body.dark .story-card { background:#2c2c2c; color:white; }
  body.dark .category { opacity:0.9; }

  /* Layout */
  .container { display:flex; min-height:100vh; }
  .sidebar { width:250px; background:#42a5f5; color:white; padding:2rem 1rem; display:flex; flex-direction:column; transition:0.3s; }
  .sidebar h2 { margin-bottom:1.5rem; font-size:1.5rem; text-align:center; }
  .sidebar .user { margin-bottom:2rem; text-align:center; }
  .sidebar .user img { width:80px; height:80px; border-radius:50%; margin-bottom:0.5rem; }
  .sidebar a { padding:0.8rem 1rem; border-radius:8px; margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem; transition:0.3s; }
  .sidebar a:hover { background: rgba(255,255,255,0.2); }
  .sidebar a.logout { margin-top:auto; background:#e53935; justify-content:center; }
  .sidebar a.logout:hover { background:#c62828; }

  .main { flex:1; padding:2rem; overflow-y:auto; }

  /* Hero */
  .hero { background: linear-gradient(135deg, #e3f2fd, #fce4ec); padding:2rem; border-radius:12px; text-align:center; margin-bottom:2rem; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:0.3s; }
  .hero h1 { margin-bottom:0.5rem; }
  .hero p { margin-bottom:1rem; font-size:1.1rem; color:#555; }
  .hero button { background:#1e88e5; color:white; padding:12px 24px; border-radius:25px; font-size:1rem; transition:0.3s; }
  .hero button:hover { background:#1565c0; transform:translateY(-2px); }

  /* Sections */
  section { margin-bottom:2rem; }
  section h2 { margin-bottom:1rem; font-size:1.3rem; }

  /* Story Cards */
  .story-list { display:flex; gap:1rem; overflow-x:auto; padding-bottom:0.5rem; }
  .story-card { background:white; border-radius:14px; overflow:hidden; min-width:220px; box-shadow:0 4px 12px rgba(0,0,0,0.08); transition:transform 0.3s; flex-shrink:0; }
  .story-card:hover { transform:translateY(-5px); box-shadow:0 6px 18px rgba(0,0,0,0.12); }
  .story-card img { width:100%; height:140px; object-fit:cover; border-bottom:1px solid #ddd; }
  .story-card .content { padding:1rem; }
  .story-card h3 { margin-bottom:0.3rem; font-size:1.1rem; }
  .story-card p { margin-bottom:0.5rem; color:#666; font-size:0.9rem; }
  .story-card button { background:#66bb6a; color:white; padding:8px 14px; border-radius:6px; transition:0.3s; margin-top:5px; width:100%; }
  .story-card button:hover { background:#43a047; }

  /* Categories */
  .categories { display:flex; gap:1rem; overflow-x:auto; padding-bottom:0.5rem; }
  .category { min-width:150px; padding:1rem; border-radius:12px; font-weight:600; text-align:center; color:white; cursor:pointer; transition:0.3s; flex-shrink:0; }
  .category:nth-child(1){background:linear-gradient(135deg,#f48fb1,#f06292);}
  .category:nth-child(2){background:linear-gradient(135deg,#ba68c8,#9575cd);}
  .category:nth-child(3){background:linear-gradient(135deg,#4db6ac,#26a69a);}
  .category:nth-child(4){background:linear-gradient(135deg,#ffb74d,#ff8a65);}
  .category:hover { transform:scale(1.05); }

  /* Footer */
  footer { text-align:center; padding:1rem; background:#fafafa; color:#555; font-size:0.9rem; border-top:1px solid #ddd; margin-top:2rem; }

  /* Scrollbar */
  ::-webkit-scrollbar { height:6px; }
  ::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.2); border-radius:3px; }

  /* Reader Modal */
  #readerModal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); display:none; justify-content:center; align-items:center; z-index:9999; }
  #readerContent { background:white; width:80%; max-width:800px; max-height:90%; overflow-y:auto; border-radius:12px; padding:1.5rem; position:relative; }
  #readerContent.dark { background:#222; color:#f4f4f4; }
  #readerContent button.close { position:absolute; top:10px; right:10px; background:#e53935; color:white; padding:6px 10px; border-radius:5px; }
  #readerContent button.close:hover { background:#c62828; }
  #readerControls { display:flex; justify-content:space-between; margin-bottom:1rem; gap:1rem; }
  #readerControls button { flex:1; padding:6px 10px; border-radius:6px; background:#1e88e5; color:white; transition:0.3s; }
  #readerControls button:hover { background:#1565c0; }
  #readerText { line-height:1.6; white-space:pre-wrap; }

  /* Responsive */
  @media(max-width:768px){
    .container { flex-direction:column; }
    .sidebar { width:100%; flex-direction:row; overflow-x:auto; gap:0.5rem; padding:1rem; }
    .sidebar a { flex:1; text-align:center; margin:0; padding:0.5rem; font-size:0.9rem; }
    .main { padding:1rem; }
    .hero button { width:100%; }
    .story-card { min-width:160px; }
    .category { min-width:120px; font-size:0.9rem; }
    #readerContent { width:95%; max-height:95%; }
  }
</style>
</head>
<body>

<div class="container">
  <!-- Sidebar -->
  <div class="sidebar">
    <h2>Story Base</h2>
    <div class="user">
      <img src="https://picsum.photos/100?random=7" alt="User"/>
      <div id="username">Hello, Reader!</div>
    </div>
    <a href="#continue">üìå Continue</a>
    <a href="#categories">üìö Categories</a>
    <a href="#popular">üî• Popular</a>
    <a href="#favorites">‚ù§Ô∏è Favorites</a>
    <a href="#" onclick="toggleDarkMode()">üåó Dark/Light</a>
    <a href="#" class="logout" onclick="logout()">üö™ Logout</a>
  </div>

  <!-- Main -->
  <div class="main">
    <div class="hero">
      <h1 id="heroName">Welcome back, Reader!</h1>
      <p>Continue your journey or explore something new</p>
      <button>Start a New Story</button>
    </div>

    <section id="continue">
      <h2>üìå Continue Reading</h2>
      <div class="story-list" id="continueList"></div>
    </section>

    <section id="categories">
      <h2>üìö Categories</h2>
      <div class="categories" id="categoryList"></div>
    </section>

    <section id="popular">
      <h2>üî• Popular Stories</h2>
      <div class="story-list" id="popularList"></div>
    </section>

    <section id="favorites">
      <h2>‚ù§Ô∏è Your Favorites</h2>
      <div class="story-list" id="favoritesList"></div>
    </section>
  </div>
</div>

<!-- Reader Modal -->
<div id="readerModal">
  <div id="readerContent">
    <div id="readerControls">
      <button id="decreaseFont">A-</button>
      <button id="increaseFont">A+</button>
      <button id="downloadPDF">Download PDF</button>
    </div>
    <button class="close" onclick="closeReader()">X</button>
    <div id="readerText"></div>
  </div>
</div>

<footer>
  <p>&copy; 2025 Story Base | About | Contact | Privacy | Socials</p>
</footer>

<script>
  // --- User Login ---
  const storedName = localStorage.getItem('userName') || 'Reader';
  document.getElementById('username').textContent = storedName;
  document.getElementById('heroName').textContent = `Welcome back, ${storedName}!`;

  function logout() {
    localStorage.removeItem('userName');
    location.href = "welcomepage.html";
  }

  // --- Stories Array ---
  const stories = [];
  for(let i=1;i<=10;i++){
    stories.push({
      title:"The Storm of Ravens",
      chapter:i.toString(),
      cover:`https://picsum.photos/400/200?random=${i}`,
      link:`stories/storm-of-ravens/chapter${i}.html`
    });
  }

  const categories = ["üíñ Romance","üî™ Thriller","üìö Kids","üåç Folklore","üëª Horror","üöÄ Sci-Fi"];

  // --- Render Stories ---
  function renderStories(listId, storyArray){
    const container = document.getElementById(listId);
    container.innerHTML="";
    storyArray.forEach(story=>{
      const card=document.createElement('div');
      card.className='story-card';
      card.innerHTML=`
        <img src="${story.cover}" alt="Story cover" loading="lazy">
        <div class="content">
          <h3>${story.title}</h3>
          <p>Chapter ${story.chapter}</p>
          <button onclick="openReader('${story.chapter}')">Read Now</button>
        </div>
      `;
      container.appendChild(card);
    });
  }

  // --- Render Categories ---
  function renderCategories(listId, categoryArray){
    const container=document.getElementById(listId);
    container.innerHTML="";
    categoryArray.forEach(cat=>{
      const div=document.createElement('div');
      div.className='category';
      div.textContent=cat;
      container.appendChild(div);
    });
  }

  renderStories('continueList', stories.slice(0,2));
  renderStories('popularList', stories.slice(2,5));
  renderStories('favoritesList', stories.slice(3,6));
  renderCategories('categoryList', categories);

  // --- Reader Modal ---
  const modal=document.getElementById('readerModal');
  const readerText=document.getElementById('readerText');
  let currentChapter=1;
  let fontSize=16;

  async function openReader(chapter){
    currentChapter=chapter;
    modal.style.display='flex';
    fontSize=16;
    readerText.style.fontSize=fontSize+'px';
    try{
      const res=await fetch(`stories/storm-of-ravens/chapter${chapter}.html`);
      const html=await res.text();
      const parser=new DOMParser();
      const docHTML=parser.parseFromString(html,'text/html');
      readerText.textContent=docHTML.body.innerText;
    } catch(err){
      readerText.textContent='Failed to load chapter.';
    }
  }

  function closeReader(){
    modal.style.display='none';
  }

  document.getElementById('increaseFont').addEventListener('click', ()=>{
    fontSize+=2;
    readerText.style.fontSize=fontSize+'px';
  });
  document.getElementById('decreaseFont').addEventListener('click', ()=>{
    if(fontSize>10) fontSize-=2;
    readerText.style.fontSize=fontSize+'px';
  });

  // --- Download PDF ---
  document.getElementById('downloadPDF').addEventListener('click', async ()=>{
    const { jsPDF } = window.jspdf;
    const doc=new jsPDF();
    doc.setFontSize(14);
    doc.text(`The Storm of Ravens - Chapter ${currentChapter}`,10,20);
    const lines=readerText.textContent.split('\n').filter(l=>l.trim()!=='');
    let y=30;
    lines.forEach(line=>{
      if(y>280){doc.addPage(); y=20;}
      const splitLines=doc.splitTextToSize(line,180); // prevent cutting
      splitLines.forEach(sl=>{
        doc.text(sl,10,y);
        y+=10;
        if(y>280){doc.addPage(); y=20;}
      });
    });
    doc.save(`Storm-of-Ravens-Chapter-${currentChapter}.pdf`);
  });

  // --- Dark/Light Mode ---
  function toggleDarkMode(){
    document.body.classList.toggle('dark');
    document.getElementById('readerContent').classList.toggle('dark');
  }
</script>
</body>
</html>
